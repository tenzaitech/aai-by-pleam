-- WAWAGOT V.2 Create Table Script
-- สร้างตาราง all-data-ai-wawagod

-- สร้างตาราง all-data-ai-wawagod
CREATE TABLE IF NOT EXISTS public."all-data-ai-wawagod" (
    id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    created_at timestamp with time zone NOT NULL DEFAULT now(),
    CONSTRAINT "all-data-ai-wawagod_pkey" PRIMARY KEY (id)
) TABLESPACE pg_default;

-- สร้าง index สำหรับ performance
CREATE INDEX IF NOT EXISTS idx_all_data_ai_wawagod_created_at 
ON public."all-data-ai-wawagod" (created_at);

-- เปิดใช้งาน Row Level Security (RLS)
ALTER TABLE public."all-data-ai-wawagod" ENABLE ROW LEVEL SECURITY;

-- สร้าง policy สำหรับ RLS (ให้ทุกคนอ่านได้ แต่เพิ่ม/แก้ไข/ลบได้เฉพาะ owner)
CREATE POLICY "Enable read access for all users" ON public."all-data-ai-wawagod"
    FOR SELECT USING (true);

CREATE POLICY "Enable insert for authenticated users only" ON public."all-data-ai-wawagod"
    FOR INSERT WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "Enable update for users based on id" ON public."all-data-ai-wawagod"
    FOR UPDATE USING (auth.role() = 'authenticated');

CREATE POLICY "Enable delete for users based on id" ON public."all-data-ai-wawagod"
    FOR DELETE USING (auth.role() = 'authenticated');

-- ตรวจสอบว่าสร้างสำเร็จ
SELECT 
    table_name,
    column_name,
    data_type,
    is_nullable,
    column_default
FROM information_schema.columns 
WHERE table_name = 'all-data-ai-wawagod'
ORDER BY ordinal_position;

-- แสดงข้อความสำเร็จ
SELECT '✅ Table all-data-ai-wawagod created successfully!' as status; 